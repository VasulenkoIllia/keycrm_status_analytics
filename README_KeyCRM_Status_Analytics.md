# KeyCRM Status Analytics System ‚Äì README

## 1. –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–¥–µ—è
–°–∏—Å—Ç–µ–º–∞ –±—É–¥—É—î—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø—ñ **event-log**: –∫–æ–∂–Ω–∞ –∑–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ KeyCRM —Ñ—ñ–∫—Å—É—î—Ç—å—Å—è —è–∫ –æ–∫—Ä–µ–º–∞ –ø–æ–¥—ñ—è.
–ù—ñ—è–∫—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –∞–±–æ –Ω–µ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è ‚Äî —Ü–µ –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Ö—É–≤–∞—Ç–∏ —á–∞—Å –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –≤—ñ–¥–∫–∞—Ç–∞—Ö —Å—Ç–∞—Ç—É—Å—ñ–≤.

---

## 2. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏
```
KeyCRM (2 –ø—Ä–æ—î–∫—Ç–∏)
   ‚Üì Webhook POST
Node.js backend
   ‚Üì
PostgreSQL (source of truth)
   ‚Üì
REST API / WebSocket
   ‚Üì
React Dashboard
```

- Postgres ‚Äî —î–¥–∏–Ω–µ –¥–∂–µ—Ä–µ–ª–æ —ñ—Å—Ç–∏–Ω–∏
- React –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –≤–∂–µ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ
- –î–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –±–µ–∑—à–æ–≤–Ω–æ (realtime)

---

## 3. –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –¥–µ–∫—ñ–ª—å–∫–æ—Ö CRM / –ø—Ä–æ—î–∫—Ç—ñ–≤
- –û–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
- –†—ñ–∑–Ω—ñ –Ω–∞–±–æ—Ä–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤
- –í—Å—è –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (—Å–ª–æ–≤–Ω–∏–∫–∏)

–î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É = –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É, –±–µ–∑ –∑–º—ñ–Ω –∫–æ–¥—É.

---

## 4. –ú–æ–¥–µ–ª—å –¥–∞–Ω–∏—Ö (PostgreSQL)

### 4.1 order_status_events (event-log)
1 —Ä—è–¥–æ–∫ = 1 –∑–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É

- project_id
- order_id
- order_number
- status_id
- status_group_id
- status_changed_at
- order_created_at
- payload (jsonb)
- dedup_key (UNIQUE)

### 4.2 –°–ª–æ–≤–Ω–∏–∫–∏
- status_dict (status_id ‚Üí status_name)
- status_group_dict (group_id ‚Üí stage_name)
- sla_stage_rules (stage ‚Üí SLA)

### 4.3 orders_current (–æ–ø—Ü—ñ–π–Ω–æ)
–¢–∞–±–ª–∏—Ü—è –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.

---

## 5. –û–±—Ä–æ–±–∫–∞ webhook
Endpoint:
```
POST /api/webhooks/keycrm?project={id}&token=<webhook_token>
```
–∞–±–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-webhook-token: <token>`.

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è:
- —è–∫—â–æ env `WEBHOOK_TOKEN` –∑–±—ñ–≥—Å—è ‚Äî –ø—Ä–æ—Ö—ñ–¥;
- —ñ–Ω–∞–∫—à–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è `projects.webhook_token` –¥–ª—è `project_id`; —è–∫—â–æ –ø–æ–ª–µ –ø–æ—Ä–æ–∂–Ω—î ‚Äî –ø—Ä–æ—Ö—ñ–¥; —è–∫—â–æ –∑–∞–¥–∞–Ω–µ ‚Äî –º–∞—î –∑–±—ñ–≥—Ç–∏—Å—è –∑ –ø–µ—Ä–µ–¥–∞–Ω–∏–º token.

–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ–¥—ñ—ó
2. –§–æ—Ä–º—É–≤–∞–Ω–Ω—è dedup_key
3. INSERT INTO order_status_events (ON CONFLICT DO NOTHING)
4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è orders_current (–∑–±–µ—Ä—ñ–≥–∞—î–º–æ started_at, order_created_at, is_urgent —Ç–æ—â–æ)
5. Response 200 OK

### 5.1 –ü—Ä–∏–∫–ª–∞–¥ payload (KeyCRM `order.change_order_status`)

–í—Ö—ñ–¥ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —è–∫ JSON —ñ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ Cloudflare. –û—Å–Ω–æ–≤–Ω—ñ –¥–∞–Ω—ñ —Å–∏–¥—è—Ç—å —É `body.context`:

```json
{
  "event": "order.change_order_status",
  "context": {
    "id": 23196,
    "source_uuid": "‚Ññ18766",
    "global_source_uuid": "5821089251461",
    "status_on_source": "new",
    "status_group_id": 1,
    "status_id": 1,
    "status_changed_at": "2026-01-29T18:53:35.000000Z",
    "ordered_at": "2026-01-29T11:30:49.000000Z",
    "created_at": "2026-01-29T11:35:03.000000Z",
    "updated_at": "2026-01-29T18:53:35.000000Z",
    "grand_total": 1198,
    "payments_total": 0,
    "products_total": 1198,
    "payment_status": "not_paid",
    "client_id": 23043,
    "manager_id": 6,
    "manager_comment": "... –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω—ñ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞, –¥–æ—Å—Ç–∞–≤–∫—É, UTM ..."
  }
}
```

**–ö–ª—é—á–æ–≤—ñ –ø–æ–ª—è, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ:**
- –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: `id`, `source_uuid`, `global_source_uuid`, `source_id` (–ø—Ä–æ—î–∫—Ç), `client_id`, `manager_id`.
- –°—Ç–∞—Ç—É—Å–∏: `status_on_source`, `status_group_id`, `status_id`, `status_changed_at`, `status_expired_at` (—è–∫—â–æ —î), `payment_status`.
- –ß–∞—Å–æ–≤—ñ –º—ñ—Ç–∫–∏: `ordered_at`, `created_at`, `updated_at`, `source_updated_at`, `closed_at`.
- –§—ñ–Ω–∞–Ω—Å–∏: `grand_total`, `products_total`, `total_discount`, `payments_total`, `margin_sum`, `expenses_sum`, `shipping_price`, `taxes`.
- –ö–æ–º–µ–Ω—Ç–∞—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞: –º—ñ—Å—Ç–∏—Ç—å –∞–¥—Ä–µ—Å—É, —Å–ø–æ—Å—ñ–± –¥–æ—Å—Ç–∞–≤–∫–∏/–æ–ø–ª–∞—Ç–∏, –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ UTM/fbclid ‚Äî –≤–∏—Ç—è–≥—É—î–º–æ –æ–∫—Ä–µ–º–∏–º–∏ –ø–æ–ª—è–º–∏ –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏.

**Dedup:** –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –∫–ª—é—á –∑–∞ `context.id + status_changed_at` –∞–±–æ UUID –ø–æ–¥—ñ—ó, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –≤—Å—Ç–∞–≤–∫–∏.

Webhook –æ–±—Ä–æ–±–Ω–∏–∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ª–µ–≥–∫–∏–π.

---

## 6. –Ü–Ω—Ç–µ—Ä–≤–∞–ª–∏ —á–∞—Å—É (–∫–ª—é—á–æ–≤–∞ –ª–æ–≥—ñ–∫–∞)
- –í—Ö—ñ–¥ —É —Å—Ç–∞—Ç—É—Å = —á–∞—Å –ø–æ–¥—ñ—ó
- –í–∏—Ö—ñ–¥ = —á–∞—Å –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –ø–æ–¥—ñ—ó
- –ü–æ–≤—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å—É ‚Üí –Ω–æ–≤–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª
- –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å —É —Å—Ç–∞—Ç—É—Å—ñ = —Å—É–º–∞ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ SQL window function `LEAD()`.

---

## 7. –û—Å–Ω–æ–≤–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏

### 7.1 –ü–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—é
- –ß–∞—Å —É –∫–æ–∂–Ω–æ–º—É —Å—Ç–∞—Ç—É—Å—ñ
- –ß–∞—Å –ø–æ –∫–æ–∂–Ω–æ–º—É –µ—Ç–∞–ø—É
- –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª: **–ù–æ–≤–∏–π ‚Üí –ü–µ—Ä–µ–¥–∞–Ω–æ –≤ –¥–æ—Å—Ç–∞–≤–∫—É**
- –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è ‚Üí –¥–æ—Å—Ç–∞–≤–∫–∞**

### 7.2 –ü–æ –ø–µ—Ä—ñ–æ–¥—É
- –î–µ–Ω—å / —Ç–∏–∂–¥–µ–Ω—å / –º—ñ—Å—è—Ü—å / —Ä—ñ–∫
- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –¥–∞—Ç–∞–º–∏ –æ–±–æ–≤ º—è–∑–∫–æ–≤–∞

---

## 8. SLA —Ç–∞ –∫–æ–ª—å–æ—Ä–æ–≤–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è

| –ï—Ç–∞–ø | –õ—ñ–º—ñ—Ç |
|----|----|
| –ù–æ–≤–∏–π | –¥–æ 8 –≥–æ–¥ |
| –ü–æ–≥–æ–¥–∂–µ–Ω–Ω—è | –¥–æ 24 –≥–æ–¥ |
| –í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ | –¥–æ 24 –≥–æ–¥ |
| –î–æ—Å—Ç–∞–≤–∫–∞ | –¥–æ 12 –≥–æ–¥ |

–ö–æ–ª—å–æ—Ä–∏:
- üü¢ –∑–µ–ª–µ–Ω–∏–π ‚Äî –≤ –º–µ–∂–∞—Ö SLA
- üü° –∂–æ–≤—Ç–∏–π ‚Äî –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è
- üî¥ —á–µ—Ä–≤–æ–Ω–∏–π ‚Äî –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è

---

## 9. Frontend (React)

### –î–∞—à–±–æ—Ä–¥
- KPI: –∫—ñ–ª—å–∫—ñ—Å—Ç—å, —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ/–∑–≤–∏—á–∞–π–Ω—ñ, —Å–µ—Ä–µ–¥–Ω—ñ–π/–º–µ–¥—ñ–∞–Ω–∞/p95 —Ü–∏–∫–ª, SLA OK/Near/Over.
- –§—ñ–ª—å—Ç—Ä–∏: –¥–∞—Ç–∞-–¥—ñ–∞–ø–∞–∑–æ–Ω (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º ¬´—Å—å–æ–≥–æ–¥–Ω—ñ¬ª), –ø–æ—à—É–∫ –∑–∞ –Ω–æ–º–µ—Ä–æ–º, —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ/–ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ, SLA (OK/Near/Over), –µ—Ç–∞–ø, —Å—Ç–∞—Ç—É—Å, –ª—ñ–º—ñ—Ç –≤–∏–±—ñ—Ä–∫–∏ (10/20/50/100/200/500). –£—Å—ñ –º–µ—Ç—Ä–∏–∫–∏ –¥–∞—à–±–æ—Ä–¥—É —Ä–∞—Ö—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è—Ö.
- –ö–∞—Ä—Ç–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: –±–∞—Ä –ø–æ –µ—Ç–∞–ø–∞—Ö –∑ SLA-–∫–æ–ª—å–æ—Ä–∞–º–∏, —Ä–æ–±–æ—á–∏–π/—Ñ–∞–∫—Ç–∏—á–Ω–∏–π —á–∞—Å, –ø—Ä–∞–≤–∏–ª–æ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ, —Ç—É–º–±–ª–µ—Ä —Ä—É—á–Ω–æ–≥–æ urgent, —à–≤–∏–¥–∫–∏–π –ø–µ—Ä–µ—Ö—ñ–¥ —É –º–æ–¥–∞–ª–∫—É.
- –ú–æ–¥–∞–ª–∫–∞ —Ç–∞–π–º–ª–∞–π–Ω—É (3 –≤–∫–ª–∞–¥–∫–∏): –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è, –ß–∞—Å –ø–æ –µ—Ç–∞–ø–∞—Ö (—Ä–æ–±–æ—á–∏–π/—Ñ–∞–∫—Ç–∏—á–Ω–∏–π, SLA –ø–æ –∫–æ–∂–Ω–æ–º—É –µ—Ç–∞–ø—É), –¢–∞–π–º–ª–∞–π–Ω –ø–µ—Ä–µ—Ö–æ–¥—ñ–≤.
- Realtime: SSE —Å—Ç—Ä—ñ–º –Ω–∞ Redis pub/sub, —Ñ–∞–∫—Ç–∏—á–Ω–∏–π —á–∞—Å –Ω–∞ –∫–∞—Ä—Ç–∫–∞—Ö –∞–≤—Ç–æ–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ–∂–Ω—ñ 30 —Å.

### –ó–≤—ñ—Ç–∏ (–æ–∫—Ä–µ–º–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞, —Ñ—ñ–ª—å—Ç—Ä–∏ –¥–∞—à–±–æ—Ä–¥—É –Ω–µ –≤–ø–ª–∏–≤–∞—é—Ç—å)
- –ö–∞—Å—Ç–æ–º–Ω–∏–π –∑–≤—ñ—Ç: –±–∞–≥–∞—Ç–æ–≤–∏–±—ñ—Ä –µ—Ç–∞–ø—ñ–≤/—Å—Ç–∞—Ç—É—Å—ñ–≤, SLA-—Å—Ç–∞–Ω, —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å, ¬´–ª–∏—à–µ –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ¬ª, –¥–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤—ñ–¥/–¥–æ; —Ä—è–¥–∫–∏ –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ ‚Üí –º–æ–¥–∞–ª–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.
- –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å: % –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å –∑–∞ –ø–µ—Ä—ñ–æ–¥, —Ä–æ–∑—Ä—ñ–∑ –ø–æ –µ—Ç–∞–ø–∞—Ö, —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏—Ö.
- –í—ñ–¥–º—ñ–Ω–∏: —á–∞—Å—Ç–∫–∞ —Å–∫–∞—Å–æ–≤–∞–Ω–∏—Ö, —Ä–æ–∑—Ä—ñ–∑ –ø–æ –µ—Ç–∞–ø—É –≤—ñ–¥–º—ñ–Ω–∏, —Å–ø–∏—Å–æ–∫.
- –£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å: –æ–Ω—Ç–∞–π–º vs –∑ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–Ω—è–º–∏, —Å–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–±–æ—á–∏–π/—Ñ–∞–∫—Ç–∏—á–Ω–∏–π —Ü–∏–∫–ª, –µ—Ç–∞–ø–∏ –∑ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–Ω—è–º–∏.
- SLA-–∑–≤—ñ—Ç: —Å—Ç–∞–Ω–∏ SLA –ø–æ –∫–æ–∂–Ω–æ–º—É –µ—Ç–∞–ø—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è, –∫–æ–ª—å–æ—Ä–æ–≤—ñ Chip-–∏.
- –ß–∞—Å –ø–æ –µ—Ç–∞–ø–∞—Ö: —Å–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–±–æ—á–∏–π/—Ñ–∞–∫—Ç–∏—á–Ω–∏–π —Ü–∏–∫–ª, —Å–µ—Ä–µ–¥–Ω—ñ–π —á–∞—Å –ø–æ –µ—Ç–∞–ø–∞—Ö, –¥–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è ¬´—Ä–æ–±–æ—á–∏–π/—Ñ–∞–∫—Ç–∏—á–Ω–∏–π¬ª –Ω–∞ –∫–æ–∂–Ω–æ–º—É –µ—Ç–∞–ø—ñ –≤ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ.
- –£—Å—ñ —Ç–∞–±–ª–∏—Ü—ñ –º–∞—é—Ç—å —á–µ—Ä–≥—É–≤–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ –¥–ª—è –∫—Ä–∞—â–æ—ó —á–∏—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—ñ; —Ä—è–¥–æ–∫ = –ø–µ—Ä–µ—Ö—ñ–¥ —É –º–æ–¥–∞–ª–∫—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
- SLA (–≤–∫–ª. –ø–æ—Ä—ñ–≥ Near), —Ü–∏–∫–ª –æ–±—Ä–∞—Ö—É–Ω–∫—É, —Ä–æ–±–æ—á—ñ –≥–æ–¥–∏–Ω–∏ –ø–æ –µ—Ç–∞–ø–∞—Ö (—Ä–µ–¥–∞–∫—Ç–æ—Ä –∑ –ø—Ä–µ—Å–µ—Ç–∞–º–∏), –ø—Ä–∞–≤–∏–ª–∞ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ, —Ä—É—á–Ω–∏–π override, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—É (Base URL/API token, webhook URL/token). –õ–µ–π–±–ª–∏ —ñ–Ω–ø—É—Ç—ñ–≤ –ø—Ä–∏–º—É—Å–æ–≤–æ ¬´shrink¬ª, —â–æ–± –Ω–µ –Ω–∞–∫–ª–∞–¥–∞–ª–∏—Å—è –Ω–∞ –ø–æ–ª—è.
- –í–∏–±—ñ—Ä –ø—Ä–æ—î–∫—Ç—É –∑—ñ —Å–ø–∏—Å–∫—É `/api/projects` (–±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥—É); —É—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —ñ–∑–æ–ª—å–æ–≤–∞–Ω—ñ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ø—Ä–æ—î–∫—Ç—É.

### –ú–µ—Ä–µ–∂–∞ –π –∫–µ—à
- ETag –≤–∏–º–∫–Ω–µ–Ω–æ, `Cache-Control: no-store` ‚Äî —Ñ—Ä–æ–Ω—Ç –∑–∞–≤–∂–¥–∏ —Ç—è–≥–Ω–µ —Å–≤—ñ–∂—ñ –¥–∞–Ω—ñ.
- –í–µ–±—Ö—É–∫ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –∑ –≤–∞–ª—ñ–¥–Ω–∏–º `token` (query –∞–±–æ `x-webhook-token`); —è–∫—â–æ –¥–ª—è –ø—Ä–æ—î–∫—Ç—É —Ç–æ–∫–µ–Ω –Ω–µ –∑–∞–¥–∞–Ω–∏–π ‚Äî 401.

---

## 10. –ü–ª–∞–Ω —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó MVP (5 –¥–Ω—ñ–≤)

**–î–µ–Ω—å 1**
- –ë–î + –º—ñ–≥—Ä–∞—Ü—ñ—ó
- Webhook endpoint
- Dedup

**–î–µ–Ω—å 2**
- –°–ª–æ–≤–Ω–∏–∫–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤
- SQL views —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤

**–î–µ–Ω—å 3**
- –ú–µ—Ç—Ä–∏–∫–∏
- SLA –ª–æ–≥—ñ–∫–∞

**–î–µ–Ω—å 4**
- React UI
- –¢–∞–π–º–ª–∞–π–Ω

**–î–µ–Ω—å 5**
- –î—Ä—É–≥–∏–π CRM –ø—Ä–æ—î–∫—Ç
- Realtime
- –°—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è

---

## 11. –ü–æ—Ç–æ—á–Ω–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (02.02.2026)
- Vite + React 18, MUI (dark), dayjs; –º–æ–±—ñ–ª—å–Ω–∞/–¥–µ—Å–∫—Ç–æ–ø –∞–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–∞.
- –î–∞—à–±–æ—Ä–¥: —Ñ—ñ–ª—å—Ç—Ä–∏ (–¥–∞—Ç–∞, –ø–æ—à—É–∫, –µ—Ç–∞–ø/—Å—Ç–∞—Ç—É—Å, SLA, —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ/–ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ, –ª—ñ–º—ñ—Ç –≤–∏–±—ñ—Ä–∫–∏), —Ä–µ–∞–ª—å–Ω–∏–π —á–∞—Å, –∫–∞—Ä—Ç–∫–∏ –∑ —Ä–æ–±–æ—á–∏–º/—Ñ–∞–∫—Ç–∏—á–Ω–∏–º —á–∞—Å–æ–º —ñ SLA-–±–∞—Ä–æ–º.
- –ó–≤—ñ—Ç–∏: –æ–∫—Ä–µ–º–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑ 6 –∑–≤—ñ—Ç–∞–º–∏ (–∫–∞—Å—Ç–æ–º–Ω–∏–π, –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –≤—ñ–¥–º—ñ–Ω–∏, —É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å, SLA, —á–∞—Å –ø–æ –µ—Ç–∞–ø–∞—Ö); –∫–æ–∂–µ–Ω –º–∞—î –≤–ª–∞—Å–Ω—ñ —Ñ—ñ–ª—å—Ç—Ä–∏, –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ —Ä—è–¥–∫–∏ –≤—ñ–¥–∫—Ä–∏–≤–∞—é—Ç—å –º–æ–¥–∞–ª–∫—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.
- –ú–æ–¥–∞–ª–∫–∞ —Ç–∞–π–º–ª–∞–π–Ω—É: —Ç—Ä–∏ –≤–∫–ª–∞–¥–∫–∏ (–ó–∞–≥–∞–ª—å–Ω–∞, –ß–∞—Å –ø–æ –µ—Ç–∞–ø–∞—Ö, –¢–∞–π–º–ª–∞–π–Ω), –ø–æ–∫–∞–∑—É—î —Ä–æ–±–æ—á–∏–π/—Ñ–∞–∫—Ç–∏—á–Ω–∏–π —á–∞—Å —ñ SLA –ø–æ –µ—Ç–∞–ø–∞—Ö.
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—É/—Ä–∞–±–æ—á–∏—Ö –≥–æ–¥–∏–Ω/SLA/urgent —É UI; –ª–µ–π–±–ª–∏ —ñ–Ω–ø—É—Ç—ñ–≤ –Ω–µ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—é—Ç—å –ø–æ–ª—è.
- SLA –∫–æ–ª—å–æ—Ä–∏: üü¢ ok, üü° near (80% –ª—ñ–º—ñ—Ç—É), üî¥ over.
- –ó–∞–ø—É—Å–∫: `npm install` ‚Üí `npm run dev` (–ø–æ—Ä—Ç 5173).

---

## –ü—ñ–¥—Å—É–º–æ–∫
–°–∏—Å—Ç–µ–º–∞:
- –ö–æ—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∞—Ü—é—î –∑ –≤—ñ–¥–∫–∞—Ç–∞–º–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤
- –ú–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è
- –ù–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É—î UI –≤–∞–∂–∫–∏–º–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞–º–∏
- –ì–æ—Ç–æ–≤–∞ –¥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ç–∞ BI

---

## 12. API: –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤ –∑–∞–º–æ–≤–ª–µ–Ω—å
1. –°–∫–æ–ø—ñ—é–π `.env.example` —É `.env` —ñ –∑–∞–ø–æ–≤–Ω–∏ `KEYCRM_API_TOKEN` (KeyCRM OpenAPI –∫–ª—é—á), –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –∑–º—ñ–Ω–∏—Ç–∏ `KEYCRM_BASE_URL` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ `https://openapi.keycrm.app/v1`).
2. –®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞: `npm run fetch:statuses` ‚Äî —Ç—è–≥–Ω–µ –≤—Å—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ `GET /order/status`, –ø–æ–∫–∞–∑—É—î ¬´–í—Å—å–æ–≥–æ —Å—Ç–∞—Ç—É—Å—ñ–≤: N¬ª —ñ –¥—Ä—É–∫—É—î –ø–æ–≤–Ω–∏–π JSON –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.
3. –ï–∫—Å–ø–æ—Ä—Ç –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å—Ç–∞—Ç—É—Å—ñ–≤ —É –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π JSON (–≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ –∑–∞ `group_id`, –ø–æ—Ç—ñ–º `id`): `npm run export:statuses > tmp/statuses.json`. –ö–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –º–∞—î `id`, `name`, `alias`, `is_active`, `group_id` ‚Äî –≥–æ—Ç–æ–≤–æ –¥–ª—è `status_dict` / `status_group_dict`.

–Ø–∫—â–æ –±–∞—á–∏—à 404:
- –ü–µ—Ä–µ–≤—ñ—Ä, —â–æ `KEYCRM_BASE_URL` –º–∞—î —Å—É—Ñ—ñ–∫—Å `/v1` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `https://openapi.keycrm.app/v1`). –°–∫—Ä–∏–ø—Ç –¥–æ–¥–∞—î `/v1/` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, —è–∫—â–æ —à–ª—è—Ö –ø–æ—Ä–æ–∂–Ω—ñ–π, –∞–ª–µ –ø–æ–º–∏–ª–∫–∏ –≤ –±–∞–∑–æ–≤–æ–º—É URL –¥–∞–¥—É—Ç—å 404 –≤—ñ–¥ nginx.
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ —Ç–æ–∫–µ–Ω —á–∏–Ω–Ω–∏–π; –ø—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ —Ç–æ–∫–µ–Ω–∞ –±—É–¥–µ 401, –∞–ª–µ –¥–ª—è —Ç–µ—Å—Ç—É —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ curl –∑ —Ç–∏–º–∏ –∂ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.

---

## 13. –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω (02.02.2026)
- **–†–æ–±–æ—á—ñ –≥–æ–¥–∏–Ω–∏**: –º—ñ–≥—Ä–∞—Ü—ñ—è `working_hours`, API `GET/PUT /api/settings/working-hours`, UI-—Ä–µ–¥–∞–∫—Ç–æ—Ä; —Ç–∞–π–º—ñ–Ω–≥–∏ –π SLA —Ä–∞—Ö—É—é—Ç—å—Å—è –∑–∞ —Ä–æ–±–æ—á–∏–º –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º.
- **–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è**: `order_created_at` –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –π –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è; —Ñ–∞–∫—Ç–∏—á–Ω–∏–π/—Ä–æ–±–æ—á–∏–π —á–∞—Å —Ä–∞—Ö—É—é—Ç—å—Å—è –≤—ñ–¥ —Ü—ñ—î—ó –¥–∞—Ç–∏.
- **–í–µ–±—Ö—É–∫–∏**: –ø—Ä–∏–π–º–∞—î–º–æ —Ç—ñ–ª—å–∫–∏ –ø–æ–¥—ñ—ó, —â–æ –ø—Ä–æ–π—à–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é —Ç–æ–∫–µ–Ω–æ–º; –Ω–æ–≤—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è –ª–∏—à–µ –∑—ñ —Å—Ç–∞—Ç—É—Å—É ‚Äú–ù–æ–≤–∏–π‚Äù.
- **Urgent**: –ø—Ä–∞–≤–∏–ª–∞ + —Ä—É—á–Ω–∏–π override; `urgent_rule` –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ `orders_current`, –≤–ø–ª–∏–≤–∞—î –Ω–∞ SLA.
- **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—É**: Base URL, API token, webhook URL/token —É UI; InputLabel ¬´shrink¬ª —â–æ–± –Ω–µ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—Ç–∏ —ñ–Ω–ø—É—Ç.
- **Realtime**: SSE `/api/stream/orders` –Ω–∞ Redis pub/sub; —Ñ–∞–∫—Ç–∏—á–Ω–∏–π —á–∞—Å –Ω–∞ –∫–∞—Ä—Ç–∫–∞—Ö –∞–≤—Ç–æ–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è.
- **–ó–≤—ñ—Ç–∏**: 6 –æ–∫—Ä–µ–º–∏—Ö –∑–≤—ñ—Ç—ñ–≤ (–∫–∞—Å—Ç–æ–º–Ω–∏–π, –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å, –≤—ñ–¥–º—ñ–Ω–∏, —É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å, SLA, —á–∞—Å –ø–æ –µ—Ç–∞–ø–∞—Ö) –∑ –≤–ª–∞—Å–Ω–∏–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏, –¥–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —è–∫ –æ—Å–Ω–æ–≤–Ω–∏–π –∫—Ä–∏—Ç–µ—Ä—ñ–π, —Ä—è–¥–∫–∏ –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω—ñ.
- **–°–∫—Ä–∏–ø—Ç–∏**: `scripts/clear-orders.js` (–æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–∏—Ö –ø—Ä–æ—î–∫—Ç—É), `scripts/seed-custom.js` (–Ω–∞—Å—ñ–Ω–Ω—è –¥–æ–≤—ñ–¥–Ω–∏–∫—ñ–≤), –º—ñ–≥—Ä–∞—Ü—ñ—ó 0001‚Äì0004 –∞–∫—Ç—É–∞–ª—å–Ω—ñ.
- **–§—ñ–ª—å—Ç—Ä–∏/–¥–∞—Ç–∞–ø—ñ–∫–µ—Ä–∏**: —Ñ–æ—Ä–º–∞—Ç `DD.MM.YYYY`, –∫–Ω–æ–ø–∫–∞ ¬´today¬ª —É –∫–∞–ª–µ–Ω–¥–∞—Ä—è—Ö, –¥–µ—Ñ–æ–ª—Ç –¥–∞—Ç–∏ ‚Äî –ø–æ—Ç–æ—á–Ω–∏–π –¥–µ–Ω—å.
