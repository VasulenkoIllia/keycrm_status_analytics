# KeyCRM Status Analytics System ‚Äì README

## 1. –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–¥–µ—è
–°–∏—Å—Ç–µ–º–∞ –±—É–¥—É—î—Ç—å—Å—è –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø—ñ **event-log**: –∫–æ–∂–Ω–∞ –∑–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –≤ KeyCRM —Ñ—ñ–∫—Å—É—î—Ç—å—Å—è —è–∫ –æ–∫—Ä–µ–º–∞ –ø–æ–¥—ñ—è.
–ù—ñ—è–∫—ñ —ñ–Ω—Ç–µ—Ä–≤–∞–ª–∏ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—é—Ç—å—Å—è –∞–±–æ –Ω–µ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è ‚Äî —Ü–µ –¥–æ–∑–≤–æ–ª—è—î –∫–æ—Ä–µ–∫—Ç–Ω–æ —Ä–∞—Ö—É–≤–∞—Ç–∏ —á–∞—Å –Ω–∞–≤—ñ—Ç—å –ø—Ä–∏ –≤—ñ–¥–∫–∞—Ç–∞—Ö —Å—Ç–∞—Ç—É—Å—ñ–≤.

---

## 2. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º–∏
```
KeyCRM (2 –ø—Ä–æ—î–∫—Ç–∏)
   ‚Üì Webhook POST
Node.js backend
   ‚Üì
PostgreSQL (source of truth)
   ‚Üì
REST API / WebSocket
   ‚Üì
React Dashboard
```

- Postgres ‚Äî —î–¥–∏–Ω–µ –¥–∂–µ—Ä–µ–ª–æ —ñ—Å—Ç–∏–Ω–∏
- React –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –≤–∂–µ –∞–≥—Ä–µ–≥–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ
- –î–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –±–µ–∑—à–æ–≤–Ω–æ (realtime)

---

## 3. –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –¥–µ–∫—ñ–ª—å–∫–æ—Ö CRM / –ø—Ä–æ—î–∫—Ç—ñ–≤
- –û–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
- –†—ñ–∑–Ω—ñ –Ω–∞–±–æ—Ä–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤
- –í—Å—è –≤—ñ–¥–º—ñ–Ω–Ω—ñ—Å—Ç—å –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (—Å–ª–æ–≤–Ω–∏–∫–∏)

–î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—î–∫—Ç—É = –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É, –±–µ–∑ –∑–º—ñ–Ω –∫–æ–¥—É.

---

## 4. –ú–æ–¥–µ–ª—å –¥–∞–Ω–∏—Ö (PostgreSQL)

### 4.1 order_status_events (event-log)
1 —Ä—è–¥–æ–∫ = 1 –∑–º—ñ–Ω–∞ —Å—Ç–∞—Ç—É—Å—É

- project_id
- order_id
- order_number
- status_id
- status_group_id
- status_changed_at
- order_created_at
- payload (jsonb)
- dedup_key (UNIQUE)

### 4.2 –°–ª–æ–≤–Ω–∏–∫–∏
- status_dict (status_id ‚Üí status_name)
- status_group_dict (group_id ‚Üí stage_name)
- sla_stage_rules (stage ‚Üí SLA)

### 4.3 orders_current (–æ–ø—Ü—ñ–π–Ω–æ)
–¢–∞–±–ª–∏—Ü—è –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Å—Ç–∞–Ω—É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.

---

## 5. –û–±—Ä–æ–±–∫–∞ webhook
Endpoint:
```
POST /api/webhooks/keycrm?project={id}&token=<webhook_token>
```
–∞–±–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-webhook-token: <token>`.

–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è:
- —è–∫—â–æ env `WEBHOOK_TOKEN` –∑–±—ñ–≥—Å—è ‚Äî –ø—Ä–æ—Ö—ñ–¥;
- —ñ–Ω–∞–∫—à–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è `projects.webhook_token` –¥–ª—è `project_id`; —è–∫—â–æ –ø–æ–ª–µ –ø–æ—Ä–æ–∂–Ω—î ‚Äî –ø—Ä–æ—Ö—ñ–¥; —è–∫—â–æ –∑–∞–¥–∞–Ω–µ ‚Äî –º–∞—î –∑–±—ñ–≥—Ç–∏—Å—è –∑ –ø–µ—Ä–µ–¥–∞–Ω–∏–º token.

–ê–ª–≥–æ—Ä–∏—Ç–º:
1. –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø–æ–¥—ñ—ó
2. –§–æ—Ä–º—É–≤–∞–Ω–Ω—è dedup_key
3. INSERT INTO order_status_events (ON CONFLICT DO NOTHING)
4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è orders_current (–∑–±–µ—Ä—ñ–≥–∞—î–º–æ started_at, order_created_at, is_urgent —Ç–æ—â–æ)
5. Response 200 OK

### 5.1 –ü—Ä–∏–∫–ª–∞–¥ payload (KeyCRM `order.change_order_status`)

–í—Ö—ñ–¥ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —è–∫ JSON —ñ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ Cloudflare. –û—Å–Ω–æ–≤–Ω—ñ –¥–∞–Ω—ñ —Å–∏–¥—è—Ç—å —É `body.context`:

```json
{
  "event": "order.change_order_status",
  "context": {
    "id": 23196,
    "source_uuid": "‚Ññ18766",
    "global_source_uuid": "5821089251461",
    "status_on_source": "new",
    "status_group_id": 1,
    "status_id": 1,
    "status_changed_at": "2026-01-29T18:53:35.000000Z",
    "ordered_at": "2026-01-29T11:30:49.000000Z",
    "created_at": "2026-01-29T11:35:03.000000Z",
    "updated_at": "2026-01-29T18:53:35.000000Z",
    "grand_total": 1198,
    "payments_total": 0,
    "products_total": 1198,
    "payment_status": "not_paid",
    "client_id": 23043,
    "manager_id": 6,
    "manager_comment": "... –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω—ñ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞, –¥–æ—Å—Ç–∞–≤–∫—É, UTM ..."
  }
}
```

**–ö–ª—é—á–æ–≤—ñ –ø–æ–ª—è, —è–∫—ñ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ:**
- –Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: `id`, `source_uuid`, `global_source_uuid`, `source_id` (–ø—Ä–æ—î–∫—Ç), `client_id`, `manager_id`.
- –°—Ç–∞—Ç—É—Å–∏: `status_on_source`, `status_group_id`, `status_id`, `status_changed_at`, `status_expired_at` (—è–∫—â–æ —î), `payment_status`.
- –ß–∞—Å–æ–≤—ñ –º—ñ—Ç–∫–∏: `ordered_at`, `created_at`, `updated_at`, `source_updated_at`, `closed_at`.
- –§—ñ–Ω–∞–Ω—Å–∏: `grand_total`, `products_total`, `total_discount`, `payments_total`, `margin_sum`, `expenses_sum`, `shipping_price`, `taxes`.
- –ö–æ–º–µ–Ω—Ç–∞—Ä –º–µ–Ω–µ–¥–∂–µ—Ä–∞: –º—ñ—Å—Ç–∏—Ç—å –∞–¥—Ä–µ—Å—É, —Å–ø–æ—Å—ñ–± –¥–æ—Å—Ç–∞–≤–∫–∏/–æ–ø–ª–∞—Ç–∏, –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ UTM/fbclid ‚Äî –≤–∏—Ç—è–≥—É—î–º–æ –æ–∫—Ä–µ–º–∏–º–∏ –ø–æ–ª—è–º–∏ –¥–ª—è –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏.

**Dedup:** –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –∫–ª—é—á –∑–∞ `context.id + status_changed_at` –∞–±–æ UUID –ø–æ–¥—ñ—ó, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –≤—Å—Ç–∞–≤–∫–∏.

Webhook –æ–±—Ä–æ–±–Ω–∏–∫ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ª–µ–≥–∫–∏–π.

---

## 6. –Ü–Ω—Ç–µ—Ä–≤–∞–ª–∏ —á–∞—Å—É (–∫–ª—é—á–æ–≤–∞ –ª–æ–≥—ñ–∫–∞)
- –í—Ö—ñ–¥ —É —Å—Ç–∞—Ç—É—Å = —á–∞—Å –ø–æ–¥—ñ—ó
- –í–∏—Ö—ñ–¥ = —á–∞—Å –Ω–∞—Å—Ç—É–ø–Ω–æ—ó –ø–æ–¥—ñ—ó
- –ü–æ–≤—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å—É ‚Üí –Ω–æ–≤–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª
- –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å —É —Å—Ç–∞—Ç—É—Å—ñ = —Å—É–º–∞ —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤

–†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ SQL window function `LEAD()`.

---

## 7. –û—Å–Ω–æ–≤–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏

### 7.1 –ü–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—é
- –ß–∞—Å —É –∫–æ–∂–Ω–æ–º—É —Å—Ç–∞—Ç—É—Å—ñ
- –ß–∞—Å –ø–æ –∫–æ–∂–Ω–æ–º—É –µ—Ç–∞–ø—É
- –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª: **–ù–æ–≤–∏–π ‚Üí –ü–µ—Ä–µ–¥–∞–Ω–æ –≤ –¥–æ—Å—Ç–∞–≤–∫—É**
- –ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å: **—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è ‚Üí –¥–æ—Å—Ç–∞–≤–∫–∞**

### 7.2 –ü–æ –ø–µ—Ä—ñ–æ–¥—É
- –î–µ–Ω—å / —Ç–∏–∂–¥–µ–Ω—å / –º—ñ—Å—è—Ü—å / —Ä—ñ–∫
- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –∑–∞ –¥–∞—Ç–∞–º–∏ –æ–±–æ–≤ º—è–∑–∫–æ–≤–∞

---

## 8. SLA —Ç–∞ –∫–æ–ª—å–æ—Ä–æ–≤–∞ —ñ–Ω–¥–∏–∫–∞—Ü—ñ—è

| –ï—Ç–∞–ø | –õ—ñ–º—ñ—Ç |
|----|----|
| –ù–æ–≤–∏–π | –¥–æ 8 –≥–æ–¥ |
| –ü–æ–≥–æ–¥–∂–µ–Ω–Ω—è | –¥–æ 24 –≥–æ–¥ |
| –í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ | –¥–æ 24 –≥–æ–¥ |
| –î–æ—Å—Ç–∞–≤–∫–∞ | –¥–æ 12 –≥–æ–¥ |

–ö–æ–ª—å–æ—Ä–∏:
- üü¢ –∑–µ–ª–µ–Ω–∏–π ‚Äî –≤ –º–µ–∂–∞—Ö SLA
- üü° –∂–æ–≤—Ç–∏–π ‚Äî –Ω–∞–±–ª–∏–∂–µ–Ω–Ω—è
- üî¥ —á–µ—Ä–≤–æ–Ω–∏–π ‚Äî –ø–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è

---

## 9. Frontend (React)

### –û—Å–Ω–æ–≤–Ω—ñ –±–ª–æ–∫–∏
- –°–ø–∏—Å–æ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å –∑ KPI
- –¢–∞–π–º–ª–∞–π–Ω –ø—Ä–æ—Ü–µ—Å—É
- –ü—ñ–¥—Å—É–º–æ–∫ –ø–æ —Å—Ç–∞—Ç—É—Å–∞—Ö —Ç–∞ –µ—Ç–∞–ø–∞—Ö
- –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –∑–∞ –ø–µ—Ä—ñ–æ–¥
- Realtime –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (SSE)
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è SLA/—Ü–∏–∫–ª—É/—Ä–æ–±–æ—á–∏—Ö –≥–æ–¥–∏–Ω/—Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ –≤ UI
- –í–∏–±—ñ—Ä –ø—Ä–æ—î–∫—Ç—É –∑—ñ —Å–ø–∏—Å–∫—É `/api/projects` (–±–µ–∑ —Ö–∞—Ä–¥–∫–æ–¥—É)
- API –∫–µ—à –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è (ETag –≤–∏–º–∫–Ω–µ–Ω–æ, `Cache-Control: no-store`) ‚Äî —Ñ—Ä–æ–Ω—Ç –∑–∞–≤–∂–¥–∏ –æ—Ç—Ä–∏–º—É—î –∞–∫—Ç—É–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ.
- –í–µ–±—Ö—É–∫ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –ø–æ–≤–∏–Ω–µ–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç–∏ –∑ –≤–∞–ª—ñ–¥–Ω–∏–º `token` (query –∞–±–æ `x-webhook-token`); —è–∫—â–æ –¥–ª—è –ø—Ä–æ—î–∫—Ç—É —Ç–æ–∫–µ–Ω –Ω–µ –∑–∞–¥–∞–Ω–∏–π ‚Äî 401.
- –§—ñ–ª—å—Ç—Ä –ø–æ –µ—Ç–∞–ø—É: —É —Å–ø–∏—Å–∫—É –∑–∞–º–æ–≤–ª–µ–Ω—å –º–æ–∂–Ω–∞ –≤–∏–±—Ä–∞—Ç–∏ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π –µ—Ç–∞–ø (–≥—Ä—É–ø—É —Å—Ç–∞—Ç—É—Å—ñ–≤) —ñ –ø–æ–∫–∞–∑–∞—Ç–∏ –ª–∏—à–µ —Ü—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.
- –§—ñ–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É + –ª—ñ–º—ñ—Ç –≤–∏–±—ñ—Ä–∫–∏ (10/20/50/100/200/500) ‚Äî —É—Å—ñ KPI –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ —Ä–∞—Ö—É—é—Ç—å—Å—è –≤—ñ–¥–Ω–æ—Å–Ω–æ –ø–æ—Ç–æ—á–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å.
- –í–∫–ª–∞–¥–∫–∞ ¬´–ó–≤—ñ—Ç–∏¬ª: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –∑–≤—ñ—Ç (—É—Å—ñ –ø–æ—Ç–æ—á–Ω—ñ –¥–∞–Ω—ñ) —Ç–∞ –∫–∞—Å—Ç–æ–º–Ω–∏–π –∑–≤—ñ—Ç –∑ –¥–æ–¥–∞—Ç–∫–æ–≤–∏–º–∏ —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ (–µ—Ç–∞–ø, —Å—Ç–∞—Ç—É—Å, SLA, —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ—Å—Ç—å, –¥—ñ–∞–ø–∞–∑–æ–Ω –¥–∞—Ç).
- –î–∞—à–±–æ—Ä–¥ —ñ –ó–≤—ñ—Ç–∏ —ñ–∑–æ–ª—å–æ–≤–∞–Ω—ñ: —Ñ—ñ–ª—å—Ç—Ä–∏ –¥–∞—à–±–æ—Ä–¥—É –Ω–µ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ –∑–≤—ñ—Ç, –∑–≤—ñ—Ç –∑–∞–≤–∂–¥–∏ –ø—ñ–¥—Ç—è–≥—É—î –¥–∞–Ω—ñ –æ–∫—Ä–µ–º–æ –∑–∞ –¥–∞—Ç–æ—é —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è.
- –ó–≤—ñ—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ: –ø–æ–∫–∞–∑—É—î % –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å (–±—É–¥—å-—è–∫–∏–π –µ—Ç–∞–ø) —Ç–∞ —Ä–æ–∑—Ä—ñ–∑ –ø–æ –µ—Ç–∞–ø–∞—Ö —ñ–∑ —Å–ø–∏—Å–∫–æ–º –ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å.

UI –ø–æ–≤–Ω—ñ—Å—Ç—é –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –±–ª–æ–∫-—Å—Ö–µ–º—ñ –∫–ª—ñ—î–Ω—Ç–∞.

---

## 10. –ü–ª–∞–Ω —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó MVP (5 –¥–Ω—ñ–≤)

**–î–µ–Ω—å 1**
- –ë–î + –º—ñ–≥—Ä–∞—Ü—ñ—ó
- Webhook endpoint
- Dedup

**–î–µ–Ω—å 2**
- –°–ª–æ–≤–Ω–∏–∫–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤
- SQL views —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤

**–î–µ–Ω—å 3**
- –ú–µ—Ç—Ä–∏–∫–∏
- SLA –ª–æ–≥—ñ–∫–∞

**–î–µ–Ω—å 4**
- React UI
- –¢–∞–π–º–ª–∞–π–Ω

**–î–µ–Ω—å 5**
- –î—Ä—É–≥–∏–π CRM –ø—Ä–æ—î–∫—Ç
- Realtime
- –°—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è

---

## 11. –ü–æ—Ç–æ—á–Ω–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (02.02.2026)
- Vite + React 18, MUI (dark), dayjs.
- –†–µ–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ —á–µ—Ä–µ–∑ API; –º–æ–∫–∏ –∑–∞–ª–∏—à–µ–Ω—ñ —è–∫ –¥–µ–º–æ.
- –§—ñ–ª—å—Ç—Ä–∏: –¥–∞—Ç–∞-–¥—ñ–∞–ø–∞–∑–æ–Ω, –ø–æ—à—É–∫, —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ/–ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ, SLA OK/Near/Over.
- –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞: —Å–µ—Ä–µ–¥–Ω—ñ–π/–º–µ–¥—ñ–∞–Ω–∞/p95 —Ü–∏–∫–ª, —Ä–æ–∑–±–∏—Ç—Ç—è —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ/–∑–≤–∏—á–∞–π–Ω—ñ, —á–∞—Å –ø–æ –µ—Ç–∞–ø–∞—Ö (—Ä–æ–±–æ—á–∏–π/—Ñ–∞–∫—Ç–∏—á–Ω–∏–π, —Å—É–º–∏).
- –ö–∞—Ä—Ç–∫–∞: –±–∞—Ä –ø–æ –µ—Ç–∞–ø–∞—Ö –∑ SLA –∫–æ–ª—å–æ—Ä–∞–º–∏, —Ä–æ–±–æ—á–∏–π/—Ñ–∞–∫—Ç–∏—á–Ω–∏–π —á–∞—Å, –ø—Ä–∞–≤–∏–ª–æ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ, —Ç—É–º–±–ª–µ—Ä —Ä—É—á–Ω–æ–≥–æ urgent.
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è: SLA (–≤–∫–ª. –ø–æ—Ä—ñ–≥ Near), —Ü–∏–∫–ª, —Ä–æ–±–æ—á—ñ –≥–æ–¥–∏–Ω–∏ –ø–æ –µ—Ç–∞–ø–∞—Ö, –ø—Ä–∞–≤–∏–ª–∞ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ, —Ä—É—á–Ω–∏–π override, –ø—Ä–æ—î–∫—Ç (API URL/—Ç–æ–∫–µ–Ω, webhook URL/—Ç–æ–∫–µ–Ω).
  - –ö–∞—Ä—Ç–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: –Ω–æ–º–µ—Ä, —Å—Ç–≤–æ—Ä–µ–Ω–æ/–æ–Ω–æ–≤–ª–µ–Ω–æ, –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞—Ç—É—Å, –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∏–π –±–∞—Ä –ø–æ –µ—Ç–∞–ø–∞—Ö –∑ –∫–æ–ª—å–æ—Ä–∞–º–∏ SLA, —á–∏–ø–∏ —Ç—Ä–∏–≤–∞–ª–æ—Å—Ç–µ–π.
  - –ú–æ–¥–∞–ª–∫–∞ —Ç–∞–π–º–ª–∞–π–Ω—É: –≤—Ö–æ–¥–∏/–≤–∏—Ö–æ–¥–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤ —Ç–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –ø–æ –∫–æ–∂–Ω–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥—É.
- SLA –∫–æ–ª—å–æ—Ä–∏: –∑–µ–ª–µ–Ω–∏–π (ok), –∂–æ–≤—Ç–∏–π (near 80% –ª—ñ–º—ñ—Ç—É), —á–µ—Ä–≤–æ–Ω–∏–π (over –ª—ñ–º—ñ—Ç—É).
- –ó–∞–ø—É—Å–∫: `npm install` ‚Üí `npm run dev` (–ø–æ—Ä—Ç 5173).

---

## –ü—ñ–¥—Å—É–º–æ–∫
–°–∏—Å—Ç–µ–º–∞:
- –ö–æ—Ä–µ–∫—Ç–Ω–æ –ø—Ä–∞—Ü—é—î –∑ –≤—ñ–¥–∫–∞—Ç–∞–º–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤
- –ú–∞—Å—à—Ç–∞–±—É—î—Ç—å—Å—è
- –ù–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É—î UI –≤–∞–∂–∫–∏–º–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∞–º–∏
- –ì–æ—Ç–æ–≤–∞ –¥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Ç–∞ BI

---

## 12. API: –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤ –∑–∞–º–æ–≤–ª–µ–Ω—å
1. –°–∫–æ–ø—ñ—é–π `.env.example` —É `.env` —ñ –∑–∞–ø–æ–≤–Ω–∏ `KEYCRM_API_TOKEN` (KeyCRM OpenAPI –∫–ª—é—á), –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –∑–º—ñ–Ω–∏—Ç–∏ `KEYCRM_BASE_URL` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ `https://openapi.keycrm.app/v1`).
2. –®–≤–∏–¥–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞: `npm run fetch:statuses` ‚Äî —Ç—è–≥–Ω–µ –≤—Å—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ `GET /order/status`, –ø–æ–∫–∞–∑—É—î ¬´–í—Å—å–æ–≥–æ —Å—Ç–∞—Ç—É—Å—ñ–≤: N¬ª —ñ –¥—Ä—É–∫—É—î –ø–æ–≤–Ω–∏–π JSON –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.
3. –ï–∫—Å–ø–æ—Ä—Ç –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å—Ç–∞—Ç—É—Å—ñ–≤ —É –∫–æ–º–ø–∞–∫—Ç–Ω–∏–π JSON (–≤—ñ–¥—Å–æ—Ä—Ç–æ–≤–∞–Ω–æ –∑–∞ `group_id`, –ø–æ—Ç—ñ–º `id`): `npm run export:statuses > tmp/statuses.json`. –ö–æ–∂–µ–Ω –µ–ª–µ–º–µ–Ω—Ç –º–∞—î `id`, `name`, `alias`, `is_active`, `group_id` ‚Äî –≥–æ—Ç–æ–≤–æ –¥–ª—è `status_dict` / `status_group_dict`.

–Ø–∫—â–æ –±–∞—á–∏—à 404:
- –ü–µ—Ä–µ–≤—ñ—Ä, —â–æ `KEYCRM_BASE_URL` –º–∞—î —Å—É—Ñ—ñ–∫—Å `/v1` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `https://openapi.keycrm.app/v1`). –°–∫—Ä–∏–ø—Ç –¥–æ–¥–∞—î `/v1/` –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, —è–∫—â–æ —à–ª—è—Ö –ø–æ—Ä–æ–∂–Ω—ñ–π, –∞–ª–µ –ø–æ–º–∏–ª–∫–∏ –≤ –±–∞–∑–æ–≤–æ–º—É URL –¥–∞–¥—É—Ç—å 404 –≤—ñ–¥ nginx.
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Å—è, —â–æ —Ç–æ–∫–µ–Ω —á–∏–Ω–Ω–∏–π; –ø—Ä–∏ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ —Ç–æ–∫–µ–Ω–∞ –±—É–¥–µ 401, –∞–ª–µ –¥–ª—è —Ç–µ—Å—Ç—É —Ç–∞–∫–æ–∂ –º–æ–∂–Ω–∞ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ curl –∑ —Ç–∏–º–∏ –∂ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏.

---

## 13. –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω (01.02.2026)
- **–†–æ–±–æ—á—ñ –¥–Ω—ñ/–≥–æ–¥–∏–Ω–∏ –ø–æ –µ—Ç–∞–ø–∞—Ö**: –º—ñ–≥—Ä–∞—Ü—ñ—è `working_hours`, API `GET/PUT /api/settings/working-hours`, UI-—Ä–µ–¥–∞–∫—Ç–æ—Ä —É Settings; —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ç–∞–π–º—ñ–Ω–≥—ñ–≤ —ñ SLA –≤—Ä–∞—Ö–æ–≤—É—î —Ä–æ–±–æ—á–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä.
- **–î–∞—Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è**: –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ (`order_created_at`), –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î—Ç—å—Å—è; –∫–∞—Ä—Ç–∫–∏ –π —Ç–∞–π–º–ª–∞–π–Ω –ø–æ–∫–∞–∑—É—é—Ç—å —Ñ–∞–∫—Ç–∏—á–Ω–∏–π —ñ —Ä–æ–±–æ—á–∏–π —á–∞—Å –≤—ñ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è.
- **–§—ñ–ª—å—Ç—Ä –≤—Ö—ñ–¥–Ω–∏—Ö –≤–µ–±—Ö—É–∫—ñ–≤**: –Ω–æ–≤—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏–π–º–∞—é—Ç—å—Å—è –ª–∏—à–µ –∑ –ø–æ–¥—ñ—î—é –≥—Ä—É–ø–∏ ‚Äú–ù–æ–≤–∏–π‚Äù; –∑–∞–ø—ñ–∑–Ω—ñ–ª—ñ –ø–æ–¥—ñ—ó —ñ–Ω—à–∏—Ö —Å—Ç–∞—Ç—É—Å—ñ–≤ –Ω–µ —Å—Ç–≤–æ—Ä—é—é—Ç—å –∑–∞–ø–∏—Å, –∞–ª–µ –æ–Ω–æ–≤–ª—é—é—Ç—å –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.
- **Urgent –ª–æ–≥—ñ–∫–∞**: –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è `urgent_rule` –≤ `orders_current`, —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–∞–≤–∏–ª —É UI, —Ä—É—á–Ω–∏–π override –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ; SLA/–∫–æ–ª—å–æ—Ä–∏ –∑–∞–ª–µ–∂–∞—Ç—å –≤—ñ–¥ —Ç–µ—Ä–º—ñ–Ω–æ–≤–æ—Å—Ç—ñ.
- **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—É**: –±–∞–∑–æ–≤–∏–π URL, API token, webhook URL/token –≤–∏–Ω–µ—Å–µ–Ω—ñ —É Settings —ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —á–µ—Ä–µ–∑ `/api/settings/project`.
- **Realtime**: SSE —Å—Ç—Ä—ñ–º `/api/stream/orders` –Ω–∞ Redis pub/sub; –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–∞—Ä—Ç–æ–∫ —ñ —Ç–∞–π–º–ª–∞–π–Ω—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —Ñ–∞–∫—Ç–∏—á–Ω–∏–π —á–∞—Å –∞–≤—Ç–æ–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç—Ü—ñ –∫–æ–∂–Ω—ñ 30 —Å–µ–∫.
- **–°–∫—Ä–∏–ø—Ç–∏**: `scripts/clear-orders.js` –¥–ª—è –æ—á–∏—â–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑–∞–º–æ–≤–ª–µ–Ω—å –ø–æ –ø—Ä–æ—î–∫—Ç—É; –º—ñ–≥—Ä–∞—Ü—ñ—ó `0002‚Äì0004` –¥–æ–¥–∞—é—Ç—å working_hours, urgent_rule, order_created_at.
- **–§—Ä–æ–Ω—Ç-—Ñ—ñ–ª—å—Ç—Ä–∏**: –¥–∞—Ç–∞-–¥—ñ–∞–ø–∞–∑–æ–Ω, –ø–æ—à—É–∫, —Ç–µ—Ä–º—ñ–Ω–æ–≤—ñ/–ø—Ä–æ—Ç–µ—Ä–º—ñ–Ω–æ–≤–∞–Ω—ñ, SLA –ª—ñ—á–∏–ª—å–Ω–∏–∫–∏ –æ–∫/over; –¥–∞—Ç–∞–ø—ñ–∫–µ—Ä —É —Ñ–æ—Ä–º–∞—Ç—ñ `DD.MM.YYYY`.
